(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[572],{441:function(e,t,a){Promise.resolve().then(a.bind(a,7265)),Promise.resolve().then(a.bind(a,1211)),Promise.resolve().then(a.t.bind(a,2972,23))},7265:function(e,t,a){"use strict";a.d(t,{CreatePostForm:function(){return z}});var r=a(7437),s=a(2869),n=a(5186),i=a(6815),o=a(6818),l=a(2265),d=a(3927),c=a(875),u=a(401),p=a(2135),g=a(4508);function x(e){let{...t}=e;return(0,r.jsx)(d.fC,{"data-slot":"select",...t})}function f(e){let{...t}=e;return(0,r.jsx)(d.B4,{"data-slot":"select-value",...t})}function m(e){let{className:t,size:a="default",children:s,...n}=e;return(0,r.jsxs)(d.xz,{"data-slot":"select-trigger","data-size":a,className:(0,g.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[s,(0,r.jsx)(d.JO,{asChild:!0,children:(0,r.jsx)(c.Z,{className:"size-4 opacity-50"})})]})}function h(e){let{className:t,children:a,position:s="popper",...n}=e;return(0,r.jsx)(d.h_,{children:(0,r.jsxs)(d.VY,{"data-slot":"select-content",className:(0,g.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...n,children:[(0,r.jsx)(b,{}),(0,r.jsx)(d.l_,{className:(0,g.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,r.jsx)(j,{})]})})}function v(e){let{className:t,children:a,...s}=e;return(0,r.jsxs)(d.ck,{"data-slot":"select-item",className:(0,g.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...s,children:[(0,r.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,r.jsx)(d.wU,{children:(0,r.jsx)(u.Z,{className:"size-4"})})}),(0,r.jsx)(d.eT,{children:a})]})}function b(e){let{className:t,...a}=e;return(0,r.jsx)(d.u_,{"data-slot":"select-scroll-up-button",className:(0,g.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(p.Z,{className:"size-4"})})}function j(e){let{className:t,...a}=e;return(0,r.jsx)(d.$G,{"data-slot":"select-scroll-down-button",className:(0,g.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(c.Z,{className:"size-4"})})}var y=a(6070),w=a(970),N=a(9376),_=a(2489),k=a(3113);function z(e){let{categories:t,userId:a}=e,[d,c]=(0,l.useState)({content:"",category_id:"",tags:""}),[u,p]=(0,l.useState)(null),[g,b]=(0,l.useState)(null),[j,z]=(0,l.useState)(!1),[C,P]=(0,l.useState)(null),S=(0,l.useRef)(null),Z=(0,N.useRouter)(),L=(0,w.e)(),F=async e=>{let t=e.name.split(".").pop(),r="".concat(a,"/").concat(Date.now(),".").concat(t),{data:s,error:n}=await L.storage.from("posts").upload(r,e);if(n)return console.error("Error uploading image:",n),null;let{data:{publicUrl:i}}=L.storage.from("posts").getPublicUrl(s.path);return i},E=async e=>{e.preventDefault(),z(!0),P(null);try{let e=null;if(u&&!(e=await F(u)))throw Error("Failed to upload image");let{data:t,error:r}=await L.from("posts").insert({content:d.content,image_url:e,category_id:d.category_id||null,author_id:a}).select().single();if(r)throw r;if(d.tags.trim())for(let e of d.tags.split(",").map(e=>e.trim().toLowerCase()).filter(e=>e.length>0)){let{data:a}=await L.from("tags").select("id").eq("name",e).single(),r=null==a?void 0:a.id;if(!r){let{data:t,error:a}=await L.from("tags").insert({name:e,slug:e.replace(/\s+/g,"-")}).select("id").single();if(a)throw a;r=t.id}await L.from("post_tags").insert({post_id:t.id,tag_id:r})}P({type:"success",text:"Post created successfully!"}),Z.push("/post/".concat(t.id))}catch(e){console.error("Error creating post:",e),P({type:"error",text:"Failed to create post. Please try again."})}finally{z(!1)}},G=(e,t)=>{c(a=>({...a,[e]:t}))};return(0,r.jsxs)("form",{onSubmit:E,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{children:"Photo"}),g?(0,r.jsx)(y.Zb,{className:"relative",children:(0,r.jsxs)(y.aY,{className:"p-0",children:[(0,r.jsx)("img",{src:g||"/placeholder.svg",alt:"Preview",className:"w-full h-64 object-cover rounded-lg"}),(0,r.jsx)(s.z,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{p(null),b(null),S.current&&(S.current.value="")},children:(0,r.jsx)(_.Z,{className:"w-4 h-4"})})]})}):(0,r.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-rose-400 transition-colors cursor-pointer",onClick:()=>{var e;return null===(e=S.current)||void 0===e?void 0:e.click()},children:[(0,r.jsx)(k.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 mb-2",children:"Click to upload a photo"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]}),(0,r.jsx)("input",{ref:S,type:"file",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){p(a);let e=new FileReader;e.onload=e=>{var t;b(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(a)}},className:"hidden",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"content",children:"Caption"}),(0,r.jsx)(o.g,{id:"content",value:d.content,onChange:e=>G("content",e.target.value),placeholder:"Share your story...",rows:4,maxLength:2200,required:!0}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:[d.content.length,"/2200 characters"]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{children:"Category"}),(0,r.jsxs)(x,{value:d.category_id,onValueChange:e=>G("category_id",e),children:[(0,r.jsx)(m,{children:(0,r.jsx)(f,{placeholder:"Select a category (optional)"})}),(0,r.jsx)(h,{children:t.map(e=>(0,r.jsx)(v,{value:e.id,children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,r.jsx)("span",{children:e.name})]})},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"tags",children:"Tags"}),(0,r.jsx)(n.I,{id:"tags",type:"text",value:d.tags,onChange:e=>G("tags",e.target.value),placeholder:"fashion, style, ootd (separate with commas)"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Add relevant tags to help people discover your post"})]}),C&&(0,r.jsx)("div",{className:"p-3 rounded-lg text-sm ".concat("success"===C.type?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:C.text}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)(s.z,{type:"button",variant:"outline",onClick:()=>Z.back(),children:"Cancel"}),(0,r.jsx)(s.z,{type:"submit",disabled:j||!u,className:"bg-gradient-to-r from-rose-500 to-orange-500 hover:from-rose-600 hover:to-orange-600 text-white",children:j?"Publishing...":"Publish Post"})]})]})}},6070:function(e,t,a){"use strict";a.d(t,{Ol:function(){return i},SZ:function(){return l},Zb:function(){return n},aY:function(){return d},ll:function(){return o}});var r=a(7437);a(2265);var s=a(4508);function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...a})}function l(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-muted-foreground text-sm",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",t),...a})}},5186:function(e,t,a){"use strict";a.d(t,{I:function(){return n}});var r=a(7437);a(2265);var s=a(4508);function n(e){let{className:t,type:a,...n}=e;return(0,r.jsx)("input",{type:a,"data-slot":"input",className:(0,s.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}},6815:function(e,t,a){"use strict";a.d(t,{Label:function(){return i}});var r=a(7437);a(2265);var s=a(6394),n=a(4508);function i(e){let{className:t,...a}=e;return(0,r.jsx)(s.f,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}},6818:function(e,t,a){"use strict";a.d(t,{g:function(){return n}});var r=a(7437);a(2265);var s=a(4508);function n(e){let{className:t,...a}=e;return(0,r.jsx)("textarea",{"data-slot":"textarea",className:(0,s.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}}},function(e){e.O(0,[972,338,964,430,336,211,971,117,744],function(){return e(e.s=441)}),_N_E=e.O()}]);